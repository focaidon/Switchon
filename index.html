<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Switch-On Dash</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --w1: #2ECC71; --w2: #F1C40F; --w3: #3498DB; --w4: #9B59B6;
            --bg: #F4F7F6; --text: #2C3E50;
            --meal-bg: #E8F5E9; --meal-txt: #2E7D32;
            --pill-bg: #FFF3E0; --pill-txt: #EF6C00;
            --work-bg: #E3F2FD; --work-txt: #1565C0;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        
        .header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        .progress-container { flex: 1; margin-left: 15px; background: #DDD; height: 6px; border-radius: 3px; }
        #prog-bar { height: 100%; border-radius: 3px; transition: 0.3s; width: 0%; }

        .week-tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .w-tab { flex: 1; padding: 8px; border-radius: 8px; font-size: 11px; font-weight: 800; text-align: center; cursor: pointer; opacity: 0.6; }
        .w-tab.active { opacity: 1; color: white; }
        .w-tab:nth-child(1) { background: var(--w1); } .w-tab:nth-child(2) { background: var(--w2); }
        .w-tab:nth-child(3) { background: var(--w3); } .w-tab:nth-child(4) { background: var(--w4); }

        .day-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 15px; }
        .d-btn { padding: 10px 0; background: white; border-radius: 8px; text-align: center; border: 1px solid #EEE; cursor: pointer; }
        .d-btn.active { border: 2px solid #333; font-weight: 800; }
        .d-btn .dot { width: 4px; height: 4px; border-radius: 50%; background: #CCC; margin: 4px auto 0; }
        .d-btn.done .dot { background: var(--w1); }

        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 100px; }
        .card-title { display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #F4F7F6; padding-bottom: 10px; margin-bottom: 12px; }
        .phase-label { font-size: 12px; font-weight: 800; padding: 2px 8px; border-radius: 5px; }
        
        .task { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #FAFAFA; cursor: pointer; }
        .task input { width: 20px; height: 20px; margin-right: 12px; accent-color: #333; flex-shrink: 0; }
        .time-tag { font-size: 10px; color: #999; width: 42px; flex-shrink: 0; }
        
        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge { font-size: 10px; padding: 3px 6px; border-radius: 6px; margin-right: 8px; font-weight: 800; flex-shrink: 0; display: inline-flex; align-items: center; gap: 3px; }
        .badge-meal { background: var(--meal-bg); color: var(--meal-txt); }
        .badge-pill { background: var(--pill-bg); color: var(--pill-txt); }
        .badge-work { background: var(--work-bg); color: var(--work-txt); }
        .task-txt { font-size: 14px; font-weight: 600; color: #334155; }

        .workout-guide { margin-top: 15px; background: #F8FAFC; border-radius: 12px; overflow: hidden; border: 1px solid #E2E8F0; }
        .guide-header { padding: 12px; background: #334155; color: white; font-size: 13px; font-weight: 800; }
        .guide-content { padding: 15px; font-size: 13px; }
        .step-box { margin-bottom: 15px; }
        .step-title { font-weight: 800; color: #1E293B; margin-bottom: 5px; display: flex; align-items: center; }
        .step-title span { background: #333; color: white; font-size: 10px; padding: 1px 5px; border-radius: 3px; margin-right: 6px; }
        .step-desc { color: #64748B; font-size: 12px; line-height: 1.5; padding-left: 32px; }

        .save-btn { position: fixed; bottom: 20px; left: 15px; right: 15px; background: #333; color: white; padding: 18px; border-radius: 12px; text-align: center; font-weight: 700; border: none; z-index: 1000; }
    </style>
</head>
<body>

<div class="header">
    <div id="week-title" style="font-size: 16px; font-weight: 900;">ë°ì´í„° ì—°ê²° ì¤‘...</div>
    <div class="progress-container"><div id="prog-bar"></div></div>
</div>

<div class="week-tabs">
    <div class="w-tab active" onclick="setWeek(1)">W1</div>
    <div class="w-tab" onclick="setWeek(2)">W2</div>
    <div class="w-tab" onclick="setWeek(3)">W3</div>
    <div class="w-tab" onclick="setWeek(4)">W4</div>
</div>

<div class="day-grid" id="day-grid"></div>
<div class="card" id="task-card"></div>
<button class="save-btn" onclick="saveToCloud()">í´ë¼ìš°ë“œì— ë™ê¸°í™” ì €ì¥</button>

<script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
        apiKey: "AIzaSyDtVClk4DN0GL8iTIIk6hJm4rxx0nWABvg",
        authDomain: "switchon-db9a9.firebaseapp.com",
        databaseURL: "https://switchon-db9a9-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "switchon-db9a9",
        storageBucket: "switchon-db9a9.firebasestorage.app",
        messagingSenderId: "618182666518",
        appId: "1:618182666518:web:40e0e2bede5a8d2b2b4837",
        measurementId: "G-DLPF3D62ND"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let curW = 1; let curD = 1;
    let cloudData = {};
    const info = ["", "1ì£¼: ëª¸ì˜ ìŠ¤ìœ„ì¹˜ ì¼œê¸°", "2ì£¼: ì¸ìŠë¦° ì €í•­ì„± ê°œì„ ", "3ì£¼: ì²´ì§€ë°© ê°ëŸ‰ ê°€ì†", "4ì£¼: ì²´ì§€ë°© ê°ëŸ‰ ê°€ì†"];

    function init() {
        db.ref('tracker_data').on('value', (snapshot) => {
            cloudData = snapshot.val() || {};
            setWeek(1);
        });
    }

    function setWeek(w) {
        curW = w; curD = (w-1)*7 + 1;
        document.querySelectorAll('.w-tab').forEach((t, i) => t.classList.toggle('active', i+1 === w));
        document.getElementById('week-title').innerText = info[w];
        document.getElementById('week-title').style.color = `var(--w${w})`;
        renderGrid();
    }

    function renderGrid() {
        const grid = document.getElementById('day-grid'); grid.innerHTML = '';
        for (let i = (curW-1)*7 + 1; i <= curW*7; i++) {
            const btn = document.createElement('div');
            const isDone = checkDayDone(i);
            btn.className = `d-btn ${i === curD ? 'active' : ''} ${isDone ? 'done' : ''}`;
            btn.innerHTML = `<div style="font-size:10px; color:#888;">Day</div><div style="font-size:14px;">${i}</div><div class="dot"></div>`;
            btn.onclick = () => { curD = i; renderGrid(); };
            grid.appendChild(btn);
        }
        renderTasks();
    }

    function renderTasks() {
        const card = document.getElementById('task-card');
        const phase = curD <= 3 ? "ì§‘ì¤‘ê¸°" : (curD <= 14 ? "ë„ì…ê¸°" : "ê°€ì†ê¸°");
        
        // í•­ëª©ë³„ íƒ€ì… ì •ì˜: meal(ì‹ë‹¨), pill(ì•½), work(ìš´ë™)
        let tasks = [
            {t:"08:00", n:"ìœ ì‚°ê· /ì½”íí…(ê³µë³µ)", type:"pill", icon:"ğŸ’Š"},
            {t:"08:30", n:"ì•„ì¹¨ ì‰ì´í¬", type:"meal", icon:"ğŸ¥¤"},
            {t:"12:00", n: curD <= 3 ? "ì ì‹¬ ì‰ì´í¬" : "í˜„ë¯¸ë°¥ 1/2ê³µê¸° ì‹ì‚¬", type:"meal", icon:"ğŸ¥—"}
        ];
        if(curD >= 4) tasks.push({t:"12:30", n:"ì¢…í•©/ì˜¤ë©”ê°€/ë¹„íƒ€C", type:"pill", icon:"ğŸ’Š"});
        tasks.push({t:"15:00", n:"ì˜¤í›„ ì‰ì´í¬", type:"meal", icon:"ğŸ¥¤"});
        tasks.push({t:"19:00", n: curD <= 7 ? "ì €ë… ì‰ì´í¬" : "ë‹¨ë°±ì§ˆ ì‹ì‚¬(ë°¥X)", type:"meal", icon:"ğŸ—"});
        tasks.push({t:"19:30", n:"ì¹¼ìŠ˜/ë§ˆê·¸ë„¤ìŠ˜/ë¹„íƒ€D", type:"pill", icon:"ğŸ’Š"});
        tasks.push({t:"ìš´ë™", n: curD <= 3 ? "ê°€ë²¼ìš´ ì‚°ì±…" : "í•˜ì²´+ê²½ì‚¬ê±·ê¸° ë£¨í‹´", type:"work", icon:"ğŸƒ"});

        let html = `<div class="card-title"><span style="font-weight:900;">Day ${curD} ë£¨í‹´</span><span class="phase-label" style="background:var(--w${curW}); color:white;">${phase}</span></div>`;
        
        tasks.forEach(tk => {
            const id = `d${curD}-${tk.n.replace(/[^a-zA-Zê°€-í£]/g,'')}`;
            const isChecked = cloudData[id] ? 'checked' : '';
            const typeLabel = tk.type === 'meal' ? 'ì‹ë‹¨' : tk.type === 'pill' ? 'ì•½' : 'ìš´ë™';
            
            html += `
            <label class="task">
                <span class="time-tag">${tk.t}</span>
                <input type="checkbox" id="${id}" onchange="updateProg()" ${isChecked}>
                <span class="badge badge-${tk.type}">${tk.icon} ${typeLabel}</span>
                <span class="task-txt">${tk.n}</span>
            </label>`;
        });

        if (curD >= 4) {
            html += `<div class="workout-guide"><div class="guide-header">ğŸ‹ï¸ ì‹¤ì „ ë£¨í‹´</div><div class="guide-content">
                <div class="step-box"><div class="step-title"><span>1</span> ì¤€ë¹„ ìš´ë™</div><div class="step-desc">ì†ë„ 4.0 ê±·ê¸°</div></div>
                <div class="step-box"><div class="step-title"><span>2</span> í•˜ì²´ ë¨¸ì‹ </div><div class="step-desc">ìµìŠ¤í…ì…˜/ì»¬/ì´ë„ˆì•„ì›ƒ (3ì„¸íŠ¸)</div></div>
                <div class="step-box"><div class="step-title"><span>3</span> ê²½ì‚¬ ê±·ê¸°</div><div class="step-desc">ê²½ì‚¬ 5~8 / ì†ë„ 4.0~4.5</div></div>
                <div class="step-box"><div class="step-title"><span>4</span> ìŠ¤íŠ¸ë ˆì¹­</div><div class="step-desc">í•˜ì²´ ìœ„ì£¼ ë§ˆë¬´ë¦¬</div></div>
            </div></div>`;
        }

        card.innerHTML = html;
        updateProg();
    }

    function updateProg() {
        const cbs = document.querySelectorAll('input[type="checkbox"]');
        const checked = Array.from(cbs).filter(c => c.checked).length;
        const per = Math.round((checked / cbs.length) * 100) || 0;
        document.getElementById('prog-bar').style.width = per + '%';
        document.getElementById('prog-bar').style.backgroundColor = `var(--w${curW})`;
    }

    function saveToCloud() {
        document.querySelectorAll('input[type="checkbox"]').forEach(c => {
            cloudData[c.id] = c.checked;
        });
        db.ref('tracker_data').set(cloudData).then(() => {
            alert('í´ë¼ìš°ë“œ ì €ì¥ ë° ë™ê¸°í™” ì™„ë£Œ!');
            renderGrid();
        });
    }

    function checkDayDone(day) {
        const prefix = `d${day}-`;
        const dayTasks = Object.keys(cloudData).filter(k => k.startsWith(prefix));
        if(dayTasks.length === 0) return false;
        return dayTasks.every(k => cloudData[k] === true);
    }

    window.onload = init;
</script>
</body>
</html>
